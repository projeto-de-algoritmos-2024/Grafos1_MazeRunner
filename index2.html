<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste WebSocket - Labirinto</title>
    <script src="https://cdn.socket.io/4.0.1/socket.io.min.js"></script>
    <style>
        #canvas {
            border: 1px solid black;
            display: block;
            margin: 20px auto;
        }
    </style>
</head>
<body>
    <h1>Teste WebSocket - Labirinto</h1>
    
    <button id="gerarLabirinto">Gerar Labirinto</button>
    <button id="solucionarLabirinto">Solucionar Labirinto</button>
    
    <h2>Labirinto</h2>
    <canvas id="canvas"></canvas>

    <script>
        const socket = io('http://127.0.0.1:5000');

        // Function to draw the maze on the canvas
        function drawMatrix(matrix) {
            const canvas = document.getElementById('canvas');
            const ctx = canvas.getContext('2d');

            const width = matrix[0].length;
            const height = matrix.length;
            const scaleFactor = 10;

            canvas.width = width * scaleFactor;
            canvas.height = height * scaleFactor;

            matrix.forEach((row, y) => {
                row.forEach((pixel, x) => {
                    const color = `rgb(${pixel[0]}, ${pixel[1]}, ${pixel[2]})`;
                    ctx.fillStyle = color;
                    ctx.fillRect(x * scaleFactor, y * scaleFactor, scaleFactor, scaleFactor);
                });
            });
        }

        // Generate Maze button click event
        document.getElementById('gerarLabirinto').addEventListener('click', () => {
            const largura = prompt("Digite a largura do labirinto:");
            const altura = prompt("Digite a altura do labirinto:");
            const paredes = prompt("Digite o número de paredes para remover:");

            if (largura && altura && paredes) {
                socket.emit('send_labirinto', {
                    largura: parseInt(largura),
                    altura: parseInt(altura),
                    paredes: parseInt(paredes)
                });
            }
        });

        // Solve Maze button click event
        document.getElementById('solucionarLabirinto').addEventListener('click', () => {
            const algorithm = prompt("Digite o algoritmo (bfs ou dfs):");

            if (algorithm === 'bfs' || algorithm === 'dfs') {
                socket.emit('send_matrix', { algorithm: algorithm });
            } else {
                alert("Algoritmo inválido. Escolha 'bfs' ou 'dfs'.");
            }
        });

        // Event listener for receiving the maze from the server
        socket.on('receive_labirinto', (data) => {
            drawMatrix(data.image);
        });

        // Event listener for receiving the solved maze path from the server
        socket.on('receive_matrix', (data) => {
            drawMatrix(data.image);
        });

        // Error handling for WebSocket
        socket.on('error', (data) => {
            console.error('Erro:', data.message);
        });
    </script>
</body>
</html>
